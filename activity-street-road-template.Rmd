---
title: "Activity: Street or Road?"
author: "Nandagopal Panicker"
output: html_notebook
---

## Load in the data

```{r}
#load libraries 
library(tidyverse)
#load in the data here 
# we will only be using the "street-addresses.csv" file from the text
voters_file <- "C:\\Users\\nanda\\STAT 184 Summer\\Datasets\\street-addresses.csv"
medicare_file <- "C:\\Users\\nanda\\STAT 184 Summer\\Datasets\\CMS_ProvidersSimple.rds"
voters <- read.csv(voters_file)
medicare <- readRDS(medicare_file)

```

```{r}
head(voters$address, 20)
```
```{r}
head(medicare$address, 20)
```


## Recreate Solved Example using `sample(50)`

```{r}
Sample <- voters %>% sample_n(size = 50)
Matches_PO <- Sample %>% filter(str_detect(address, "PO"))
print(Matches_PO$address)

```
```{r}
Dont_PO <- Sample %>% filter(!str_detect(address, "PO"))
print(Dont_PO$address)
```
```{r}
pattern <- "BOX\\s+(\\d+)"
Matches_BOX <- Sample %>% filter(str_detect(address, pattern))
print(Matches_BOX$address)
```
```{r}
Dont_BOX <- Sample %>% filter(!str_detect(address, pattern))
print(Dont_BOX)
```
```{r}
BoxNumbers <- Matches_BOX %>%
  extract(address, into = "boxnum", regex = pattern)

print(BoxNumbers$boxnum)
```

## Recreate Soved Example using the entire `Address` data set

Note: I have named the dataset voters instead of address.

```{r}
Matches_PO <- voters %>% filter(str_detect(address, "PO"))
Dont_PO <- voters %>% filter(!str_detect(address, "PO"))
pattern <- "BOX\\s+(\\d+)"
Matches_BOX <- voters %>% filter(str_detect(address, pattern))
Dont_BOX <- voters %>% filter(!str_detect(address, pattern))
```

```{r}
print(Dont_PO)
```
```{r}
print(Dont_BOX)
```
```{r}
BoxNumbers <- Matches_BOX %>%
  extract(address, into = "boxnum", regex = pattern)
print(BoxNumbers$boxnum)
```


#### Additional Question: How many addresses are a PO BOX (including NCSU BOX)? 

```{r}

pattern_PO_BOX <- "PO\\s+BOX|NCSU\\s+BOX"
Matches_PO_BOX <- voters %>% filter(str_detect(address, pattern_PO_BOX))
num_PO_BOX <- nrow(Matches_PO_BOX)
num_PO_BOX
```

My answer here...... 

The number of PO Box addresses including NCSU are 10593.


## Back to the Streets: Your Turn

#### Part 1: Explain (in english) each line of the following code chunk

```{r}
pattern <- "(ST|RD|ROAD)"
LeftOvers <-
  Addresses %>% 
  filter( !grepl(pattern, address),
          !grepl("\\sAPT|UNIT\\s[\\d]+$", address),
          !grepl(" BOX ", address)
          )
```

My answer here.......

The code starts by defining a regex pattern to match street abbreviations like "ST", "RD", or "ROAD". It then filters the Addresses dataset, creating a new variable LeftOvers. The filter() function excludes rows where the address contains any of the specified abbreviations, apartment or unit designations (like "APT" or "UNIT" followed by digits), or the term "BOX" surrounded by spaces. This results in LeftOvers containing addresses that do not have any of these patterns.

#### Part 2: Implement your method on the entire `Addresses` data set. Explain how your code works line by line.

```{r}
pattern <- "(ST|RD|ROAD)"

LeftOvers <- 
  voters %>%
  filter(
    !grepl(pattern, address),
    !grepl("\\sAPT|UNIT\\s[\\d]+$", address), 
    !grepl(" BOX ", address)
  )

LeftOvers
```

My answer here.......

The code starts by defining a regex pattern to match common street abbreviations like "ST", "RD", or "ROAD". It then filters the voters dataset, creating a new variable LeftOvers. The filter() function is used to exclude rows where the address contains any of these abbreviations, as well as those with apartment or unit designations ("APT" or "UNIT" followed by digits at the end), and addresses that include the term "BOX" surrounded by spaces. The resulting LeftOvers dataset contains addresses that do not match these excluded patterns.

#### Additional Question 1: Present your result from part 2 by providing a table in descending order of popularity for the street name endings you found

```{r}
pattern_endings <- "(ST|RD|ROAD)$"
StreetEndings <- voters %>%
  filter(str_detect(address, pattern_endings)) %>%
  mutate(ending = str_extract(address, pattern_endings)) %>%
  count(ending)
StreetEndings_sorted <- StreetEndings %>%
  arrange(desc(n))
print(StreetEndings_sorted)

```

#### Additional Question 2: Present your result by using ggplot to a bar chart in descending order of popularity for the street name endings you found previously.

Note: make sure your order street names according to popularity, not alphabetically.

```{r}
ggplot(StreetEndings_sorted, aes(x = reorder(ending, -n), y = n)) +
  geom_bar(stat = "identity", fill = "blue") +
  labs(x = "Street Name Ending", y = "Count", title = "Popularity of Street Name Endings") +
  theme_minimal() +
  coord_flip() 

```

#### Additional Question 3: Comment on any patterns you see

My answer here.......

* RD is the most popular Street Name Ending with roughly 600 or so appearances
* Second Being ST with more than 300 occurences but less than 400, we can estimate it to be around 350.
* Lastly, the least popular street name ending is Road, with just below 200 appearances.